<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Gráfica</title>
  <script src=https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js></script>

</head>

<body>
  <canvas id="gráfica" style="max-height: 400px; max-width: 500px"></canvas>
  <button type="button" onclick="dameMedidas('temperatura')">Dame medidas</button>
  <script>
    Chart.defaults.global.animationEasing = "easeOutBounce";
    var colorLineaGrafica = 'red';
    var ordenada = [];
    var magnitud = 'Temperatura';
    var minOrdenada = 0;
    var maxOrdenada = 60;
    /*  for (let i = 0; i < 11; i++) {
        ordenada[i] = enteroRandom();
      }*/

    var ctx = document.getElementById("gráfica").getContext("2d");

    var barChart = new Chart(ctx, {
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true,
              min: minOrdenada,
              max: maxOrdenada
            }//ticks
          }] //yAxes
        } //scales
      }, //options
      type: 'line',
      data: {
        labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre'],
        datasets: [{
          label: magnitud,
          fill: false,
          data: ordenada,
          backgroundColor: colorLineaGrafica,
          borderColor: colorLineaGrafica
        }]//datasets
      }//data
    });

    function enteroRandom() {
      return Math.floor(Math.random() * 51);
    }

    function dameMedidas(medicion) {
      fetch('/getSensores?magnitud=' + medicion).then(function(res) {
        return res.json();
      }).then(function(med) {
        if (med.status == 404) {
          console.log('Error del servidor')
        } else {
          console.log(med);
          for (let i = 0; i < 10; i++) {
            ordenada[i] = med[i][Object.keys(med[i])[0]];
          }; //for
          barChart.update();
        }//else
      })//then
    }//dameMedidas
  </script>
</body>

</html>
